generator client {
  provider        = "prisma-client-js"
  output          = "../lib/generated/prisma"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                  String               @id @default(uuid())
  email               String               @unique
  password            String               @default("")
  name                String?
  sinNumber           String?
  businessNumber      String?
  dateOfBirth         DateTime?
  isAdmin             Boolean              @default(false)
  provider            String?              @default("credentials")
  contactNumber       String?
  profileUrl          String?
  address             String?
  occupation          String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  deleteUserAt        DateTime?
  isActive            Boolean              @default(true)
  isOnline            Boolean              @default(false)
  isRestorable        Boolean              @default(false)
  lastActivityAt      DateTime?
  maxStorageLimit     Int                  @default(1048576)
  sendBirthdayEmail   Boolean?             @default(true)
  storageUsed         Int                  @default(0)
  Account             Account[]
  receivedFiles       File[]               @relation("UserReceivedFiles")
  uploadedFiles       File[]               @relation("UserUploadedFiles")
  formResponses       FormResponse[]       @relation("UserFormResponses")
  notifications       Notification[]       @relation("UserNotifications")
  otpTokens           OtpToken[]           @relation("UserOtpTokens")
  passwordResetTokens PasswordResetToken[] @relation("UserPasswordResetTokens")
  Session             Session[]
  assignedForms       Forms[]              @relation("FormAssignedUsers")
}

model File {
  id                     String   @id @default(uuid())
  url                    String?
  path                   String?
  name                   String?
  size                   String?
  type                   String?
  isArchived             Boolean  @default(false)
  folderName             String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  uploadedById           String?
  receivedById           String?
  isAdminOnlyPrivateFile Boolean  @default(false)
  parentFolderId         String?
  parentFolder           File?    @relation("FileParentChild", fields: [parentFolderId], references: [id])
  childFiles             File[]   @relation("FileParentChild")
  receivedBy             User?    @relation("UserReceivedFiles", fields: [receivedById], references: [id])
  uploadedBy             User?    @relation("UserUploadedFiles", fields: [uploadedById], references: [id])

  @@index([uploadedById])
  @@index([receivedById])
}

model Notification {
  id        String   @id @default(uuid())
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  user      User     @relation("UserNotifications", fields: [userId], references: [id])
}

model Blogs {
  id        String   @id @default(uuid())
  title     String
  content   String
  tags      String[]
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Forms {
  id                 String             @id @default(uuid())
  title              String
  description        String?
  isActive           Boolean            @default(false)
  privacyLabel       String             @default("I consent to the processing of my personal data and agree to the privacy policy")
  isCompulsory       Boolean            @default(false)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  sequence           String[]
  assignedUsersCount Int                @default(0)
  fieldsCount        Int                @default(0)
  responsesCount     Int                @default(0)
  formResponses      FormResponse[]     @relation("FormFormResponses")
  inputs             Input[]            @relation("FormInputs")
  matrices           Matrix[]           @relation("FormMatrices")
  multipleChoice     MultipleChoice[]   @relation("FormMultipleChoices")
  netPromoterScores  NetPromoterScore[] @relation("FormNetPromoterScores")
  ratings            Rating[]           @relation("FormRatings")
  selections         Selection[]        @relation("FormSelections")
  separators         Separator[]        @relation("FormSeparators")
  assignedUsers      User[]             @relation("FormAssignedUsers")
}

model FormResponse {
  id        String       @id @default(uuid())
  isChecked Boolean      @default(false)
  userId    String
  formId    String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  answers   FormAnswer[]
  form      Forms        @relation("FormFormResponses", fields: [formId], references: [id])
  user      User         @relation("UserFormResponses", fields: [userId], references: [id])
}

model FormAnswer {
  id             String       @id @default(uuid())
  formResponseId String
  fieldId        String
  fieldType      String
  value          String
  rowId          String?
  columnId       String?
  createdAt      DateTime     @default(now())
  formResponse   FormResponse @relation(fields: [formResponseId], references: [id])
}

model Input {
  id        String   @id @default(uuid())
  label     String?
  required  Boolean  @default(false)
  type      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  formId    String
  form      Forms    @relation("FormInputs", fields: [formId], references: [id])
}

model Selection {
  id        String   @id @default(uuid())
  label     String?
  required  Boolean  @default(false)
  options   String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  formId    String
  form      Forms    @relation("FormSelections", fields: [formId], references: [id])
}

model MultipleChoice {
  id         String   @id @default(uuid())
  label      String?
  required   Boolean  @default(false)
  maxChoices Int?
  options    String[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  formId     String
  form       Forms    @relation("FormMultipleChoices", fields: [formId], references: [id])

  @@index([formId])
}

model Rating {
  id         String   @id @default(uuid())
  question   String
  required   Boolean  @default(false)
  maxRating  Int      @default(5)
  showLabels Boolean  @default(false)
  labels     String[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  formId     String
  form       Forms    @relation("FormRatings", fields: [formId], references: [id])

  @@index([formId])
}

model Matrix {
  id          String   @id @default(uuid())
  title       String
  description String?
  required    Boolean  @default(false)
  rows        String[]
  columns     String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  formId      String
  form        Forms    @relation("FormMatrices", fields: [formId], references: [id])

  @@index([formId])
}

model NetPromoterScore {
  id         String   @id @default(uuid())
  question   String
  leftLabel  String   @default("Not at all likely")
  rightLabel String   @default("Extremely likely")
  required   Boolean  @default(false)
  maxScore   Int      @default(10)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  formId     String
  form       Forms    @relation("FormNetPromoterScores", fields: [formId], references: [id])

  @@index([formId])
}

model Separator {
  id          String   @id @default(uuid())
  title       String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  formId      String
  form        Forms    @relation("FormSeparators", fields: [formId], references: [id])

  @@index([formId])
}

model OpenContact {
  id             String          @id @default(uuid())
  address        String?
  phone1         String?
  phone2         String?
  email          String?
  importantDates ImportantDate[] @relation("OpenContactImportantDates")
  links          Link[]          @relation("OpenContactLinks")
}

model Link {
  id            String      @id @default(uuid())
  name          String
  url           String
  openContactId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  openContact   OpenContact @relation("OpenContactLinks", fields: [openContactId], references: [id], onDelete: Cascade)
}

model ImportantDate {
  id            String      @id @default(uuid())
  title         String
  description   String?
  date          DateTime
  openContactId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  openContact   OpenContact @relation("OpenContactImportantDates", fields: [openContactId], references: [id], onDelete: Cascade)
}

model Testimonial {
  id        String   @id @default(uuid())
  name      String
  role      String
  text      String
  imagePath String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation("UserPasswordResetTokens", fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model OtpToken {
  id        String   @id @default(uuid())
  hashedOtp String
  expiresAt DateTime
  used      Boolean  @default(false)
  purpose   String
  email     String?
  userId    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation("UserOtpTokens", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([hashedOtp])
  @@index([email])
}

model RateLimit {
  id         String   @id @default(uuid())
  identifier String
  action     String
  createdAt  DateTime @default(now())

  @@index([identifier, action, createdAt])
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
